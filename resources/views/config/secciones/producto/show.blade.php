@extends('layouts.admin')

@section('extraCSS')
    <style>

        body { background-color: #e5e8eb  !important; }

        .card-header { background-color: #b0c1d1  !important; }

        .black-skin
        .btn-primary { background-color: #b0c1d1  !important; }

        .btn {
            box-shadow: none;
            border-radius: 15px;
        }
    </style>
    <style>
        .img-producto {
            background-size: cover;
            background-repeat: no-repeat;
            background-position: center center;
            width: 100%;
            height: 20rem;
        }

        .card {
            border-radius: 2rem;
        }

        .img-galeria {
            background-size: cover;
            background-repeat: no-repeat;
            background-position: center center;
            width: 100%;
            height: 16rem;
            border-radius: 2rem;
        }
    </style>
    <style>
        .file-upload input[type="file"], .file-upload2 input[type="file"] {
            position: absolute;
            left: -9999px;
        }

        .file-upload label, .file-upload2 label {
            display: inline-block;
            background-color: #FFFFFF;
            color: #000000;
            font-weight: 700;
            padding: 6px 12px;
            cursor: pointer;
            border-radius: 4px;
            font-weight: normal;
            opacity: 0%;
        }

        .file-upload input[type="file"] + label:before, .file-upload2 input[type="file"] + label:before {
            content: "\f07b";
            font-family: "Font Awesome 5 Free";
            font-size: 16px;
            margin-right: 5px;
            transition: all 0.5s;
        }

        .file-upload input[type="file"] + label, .file-upload2 input[type="file"] + label {
            transition: all 0.5s;
        }

        .file-upload input[type="file"]:focus + label, .file-upload2 input[type="file"]:focus + label,
        .file-upload input[type="file"] + label:hover, .file-upload2 input[type="file"] + label:hover {
            backdrop-filter: blur(5px);
            background-color: #000000;
            color: #FFFFFF;
            font-weight: 700;
            opacity: 100%;
            transition: all 0.5s;
        }
    </style>
@endsection

@section('content')

    <div class="row mt-5 mb-4 px-2">
        <a href="{{ route('seccion.show', ['slug' => 'catalogo']) }}" class="mt-5 col col-md-2 btn btn-sm btn-dark mr-auto"><i class="fa fa-reply"></i> Regresar</a>
    </div>

    <div class="container-fluid bg-white rounded">
        <div class="row">
            <div class="col-11 mx-auto">
                <div class="row py-2">
                    <div class="col-4">
                        <div class="row">
                            <div class="col position-relative">
                                <div class="img-producto" style="
                                    background-image: url('{{ asset('img/productos/'.$producto->portada) }}');
                                "></div>
                                <div class="col-9 position-absolute bottom-0 start-50 translate-middle">
                                    <form id="form_img_portada" action="cambiar_imagen" method="POST" class="file-upload" enctype="multipart/form-data">
                                        @csrf
                                        <input type="hidden" name="id_imagen" value="{{ $producto->id }}">
                                        <input type="hidden" name="tipo_imagen" value="portada_producto">
                                        <input id="img_portada_producto" class="m-0 p-0" type="file" name="archivo">
                                        <label class="col-12 m-0 px-2 d-flex justify-content-center align-items-center" for="img_portada_producto" style=" height: 100%; opacity: 100%; border-radius: 20px;">Actualizar Imagen</label>
                                    </form>
                                    <script>
                                        $('#img_portada_producto').change(function(e) {
                                            $('#form_img_portada').trigger('submit');
                                        });
                                    </script>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col text-center py-3">
                                <input type="text" class="form-control shadow-none fs-3 editarajax" data-model="Producto" data-field="nombre" data-id="{{$producto->id}}" value="{{ $producto->nombre }}">
                            </div>
                        </div>
                    </div>
                    <div class="col-8">
                        <div class="row">
                            <div class="col">
                                <textarea name="" id="" cols="30" rows="10" class="form-control shadow-none editarajax" data-model="Producto" data-field="descripcion" data-id="{{$producto->id}}">{{ $producto->descripcion }}</textarea>
                            </div>
                        </div>
                        <div class="row py-3">
                            <div class="col-4">
                                <input type="text" class="form-control shadow-none editarajax" data-model="Producto" data-field="frente" data-id="{{$producto->id}}" value="{{ $producto->frente }}">
                            </div>
                            <div class="col-4">
                                <input type="text" class="form-control shadow-none editarajax" data-model="Producto" data-field="fondo" data-id="{{$producto->id}}" value="{{ $producto->fondo }}">
                            </div>
                            <div class="col-4">
                                <input type="text" class="form-control shadow-none editarajax" data-model="Producto" data-field="alto" data-id="{{$producto->id}}" value="{{ $producto->alto }}">
                            </div>
                        </div>
                        <div class="row py-3">
                            <div class="col-8">
                                <div class="row mt-3">
                                    <div class="slider-caracteristicas">
                                        @for ($i = 0; $i < 10; $i++)
                                            <div class="col">
                                                <input type="text" class="form-control shadow-none editarajax" value="CaracterÃ­stica no. {{ $i }}">
                                            </div>
                                        @endfor
                                    </div>
                                </div>
                            </div>
                            <div class="col-4">
                                <div class="row">
                                    <div class="col-3 text-center">
                                        <a href="#/" class="btn botn-outline" data-bs-toggle="modal" data-bs-target="#caracteristicaModal">
                                            <i class="bi bi-pencil-square fs-1 text-info"></i>
                                        </a>
                                    </div>
                                    <div class="col-3 text-center">
                                        <a href="#/" class="btn botn-outline" data-bs-toggle="modal" data-bs-target="#pagosModal">
                                            <i class="bi bi-coin fs-1 text-success"></i>
                                        </a>
                                    </div>
                                    <div class="col-3 text-center">
                                        <a href="#/" class="btn botn-outline" data-bs-toggle="modal" data-bs-target="#galeriaModal">
                                            <i class="bi bi-camera-fill fs-1 text-black"></i>
                                        </a>
                                    </div>
                                    <div class="col-3 text-center">
                                        <button type="button" class="btn botn-outline" id="btnDesactivar">
                                            <i class="bi bi-trash-fill fs-1 text-danger"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container-fluid mt-3 py-3 rounded">
        <div class="row">
            <div class="slider-galeria">
                @foreach ($galeria as $g)
                    <div class="col-3 px-2 position-relative">
                        <div class="card">
                            <div class="img-galeria" style="
                                background-image: url('{{ asset('img/productos/galeria/'.$g->imagen) }}');
                            "></div>
                        </div>
                        <div class="position-absolute top-0 end-0 translate-middle-x">
                            <button type="button" class="btn btn-outline eliminarGaleriaBtn" data-id="{{ $g->id }}">
                                <i class="bi bi-x-circle-fill fs-1 fw-bold" style="color: red;"></i>
                            </button>
                            <script>
                                $(document).ready(function () {
                                    $('.eliminarGaleriaBtn').click(function () {
                                        var id = $(this).data('id');
                                        eliminarGaleria(id);
                                    });

                                    function eliminarGaleria(id) {
                                        Swal.fire({
                                            title: "Â¿Eliminar foto?",
                                            text: "Â¿EstÃ¡s seguro de que deseas continuar?",
                                            icon: "warning",
                                            showCancelButton: true,
                                            confirmButtonColor: "#d33",
                                            cancelButtonColor: "#3085d6",
                                            confirmButtonText: "Eliminar",
                                            cancelButtonText: "Cancelar"
                                        }).then((result) => {
                                            if (result.isConfirmed) {
                                                // Enviar la peticiÃ³n AJAX al controlador para eliminar la imagen
                                                $.ajax({
                                                    type: 'POST',
                                                    url: '/eliminar-galeria/' + id,
                                                    data: {_token: '{{ csrf_token() }}'},
                                                    success: function (data) {
                                                        // Actualizar la interfaz despuÃ©s de eliminar la imagen
                                                        // Puedes recargar la pÃ¡gina o realizar otras acciones necesarias
                                                        location.reload();
                                                    },
                                                    error: function (error) {
                                                        console.log(error);
                                                    }
                                                });
                                            }
                                        });
                                    }
                                });
                            </script>
                        </div>
                    </div>
                @endforeach
            </div>
        </div>
    </div>

    <div class="modal fade" id="caracteristicaModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="caracteristicaModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-3" id="caracteristicaModalLabel">CaracterÃ­sticas del producto</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col">
                            <label for="producto-caracteristica" class="py-1">Nueva caracterÃ­stica</label>
                            <input type="text" class="form-control shadow-none" placeholder="CaracterÃ­stica nueva">
                            <button type="submit" class="btn btn-dark w-100 rounded-0 mt-2">Agregar caracterÃ­stica</button>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn w-100 btn-danger rounded-0" data-bs-dismiss="modal">Cerrar ventana</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="pagosModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="pagosModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-3" id="pagosModalLabel">Precios e inventario disponible</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row py-3">
                        <div class="col">
                            <div class="row">
                                <div class="col-6">
                                    <label for="label-precio">Precio</label>
                                    <input type="number" id="label-precio" name="label-precio" step="0.01" class="form-control shadow-none editarajax" placeholder="Ingrese el precio" data-model="Producto" data-field="precio" data-id="{{$producto->id}}" value="{{ $producto->precio }}">
                                </div>
                                <div class="col-6">
                                    <label for="label-stock">Cantidad en inventario</label>
                                    <input type="number" id="label-stock" name="label-stock" class="form-control shadow-none editarajax" placeholder="Inventario disponible" data-model="Producto" data-field="stock" data-id="{{$producto->id}}" value="{{ $producto->stock }}">
                                </div>
                            </div>
                            <div class="row">
                                <div class="col">
                                    <label for="label-promocion">Promocion (Ejemplos: 15% = 0.15, 100% = 1.00)</label>
                                    <input type="number" id="label-promocion" name="label-promocion" step="0.01" class="form-control shadow-none editarajax" placeholder="Ingrese la promociÃ³n" data-model="Producto" data-field="promocion" data-id="{{$producto->id}}" value="{{ $producto->promocion }}">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn w-100 btn-danger rounded-0" data-bs-dismiss="modal">Cerrar ventana</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="galeriaModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="galeriaModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-3" id="galeriaModalLabel">Agregar imÃ¡gen a la galeria del producto</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body bg-secondary py-3">
                    <div class="row">
                        <form id="form_img_galeria" action="{{ route('galeria.store') }}" method="POST" class="file-upload" enctype="multipart/form-data">
                            @csrf
                            <input type="hidden" name="id_producto" value="{{ $producto->id }}">
                            <input type="hidden" name="tipo_imagen" value="imagen_galeria">
                            <input id="img_galeria" class="m-0 p-0" type="file" name="archivo">
                            <label class="col-12 m-0 px-2 d-flex justify-content-center align-items-center" for="img_galeria" style=" height: 100%; opacity: 100%; border-radius: 0px;">Agregar imÃ¡gen</label>
                        </form>
                        <script>
                            $('#img_galeria').change(function(e) {
                                $('#form_img_galeria').trigger('submit');
                            });
                        </script>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn w-100 btn-danger rounded-0" data-bs-dismiss="modal">Cerrar ventana</button>
                </div>
            </div>
        </div>
    </div>

@endsection

@section('extraJS')
    <script>
        // tinymce.init({
        //     selector: 'textarea',
        //             menubar: false,
        //         plugins: [
        //             'advlist autolink lists link image charmap print preview anchor',
        //             'searchreplace visualblocks code fullscreen',
        //             'insertdatetime media table paste code help wordcount',
        //                 'advlist autolink lists link image charmap print preview anchor wordcount',

        //                 'searchreplace visualblocks code fullscreen table visualblocks',
        //                 'insertdatetime media table contextmenu paste code imagetools',
        //                 'textcolor colorpicker'
        //         ],
        //             toolbar: 'forecolor backcolor | insert table | undo redo | removeformat styleselect |  bold italic underline |  alignleft aligncenter alignright alignjustify |  bullist numlist | outdent indent | link image | code visualblocks',
        //             resize: false,
        //         content_style: 'body { font-family:Helvetica,Arial,sans-serif; font-size:14px }'
        // });
    </script>
    <script>
        $('.slider-galeria').slick({
            infinite: true,
            autoplay: true,
            dots: false,
            arrows: false,
            slidesToShow: 4,
            slidesToScroll: 1
        });
    </script>
    <script>
        $('.slider-caracteristicas').slick({
            infinite: true,
            autoplay: true,
            dots: false,
            arrows: false,
            slidesToShow: 1,
            slidesToScroll: 1
        });
    </script>

    <script>
        document.getElementById('btnDesactivar').addEventListener('click', function() {
            // Muestra una confirmaciÃ³n con SweetAlert
            Swal.fire({
                title: "Â¿Eliminar producto?",
                text: "Esta acciÃ³n desactivarÃ¡ el producto de la tienda. Â¿EstÃ¡s seguro de que deseas continuar?",
                icon: "warning",
                showCancelButton: true,
                confirmButtonColor: "#d33",
                cancelButtonColor: "#3085d6",
                confirmButtonText: "Eliminar",
                cancelButtonText: "Cancelar"
            })
            .then((result) => {
                if (result.isConfirmed) {
                    // AquÃ­ puedes colocar la lÃ³gica para eliminar el elemento
                    // Puedes utilizar AJAX u otras tÃ©cnicas segÃºn tu aplicaciÃ³n
                    Swal.fire("Â¡El producto ha sido eliminado!", "", "success");
                } else {
                    Swal.fire("La eliminaciÃ³n ha sido cancelada.", "", "info");
                }
            });
        });
    </script>
@endsection



